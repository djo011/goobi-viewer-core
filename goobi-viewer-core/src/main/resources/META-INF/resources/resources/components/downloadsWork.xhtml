<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components">
    
    <composite:interface />

    <composite:implementation>

                    <!-- WORK DOWNLOADS -->
                    <div class="widget-usage__work-downloads widget__badge-container">     

                    	<h3 id="titleWork" class="widget-usage__subtitle widget__badge-container-heading">#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}</h3>

                        <!-- WORK METADATA DOWNLOAD (DOWNLOAD_METADATA CHECK) -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.topStructElement.accessPermissionDownloadMetadata}">           
                        
                            <!-- METS -->
                            <ui:fragment
                                rendered="#{activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'METS' or activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'METS_MARC'}">
                                <a 
                                    href="#{activeDocumentBean.viewManager.metsResolverUrl}"
                                    id="lidomets" 
                                    class="badge badge-dark widget-usage__work-download-lido-mets" 
                                    title="#{msg.metadata_dl_mets}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadMetsButtonLabel}"> 
                                    #{msg.downloadMetsButtonLabel}
                                </a>
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.anchorMetsResolverUrl != null}">
                                <a 
                                    href="#{activeDocumentBean.viewManager.anchorMetsResolverUrl}"
                                    id="metsanchor" 
                                    class="badge badge-dark widget-usage__work-download-mets-anchor" 
                                    title="#{msg.metadata_dl_metsAnchor}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadAnchorMetsButtonLabel}"> 
                                    #{msg.downloadAnchorMetsButtonLabel}
                                </a>
                            </ui:fragment>
                            </ui:fragment>
                        
                            <!-- LIDO -->
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'LIDO'}">
                                <a 
                                    href="#{activeDocumentBean.viewManager.lidoResolverUrl}"
                                    id="lidomets" 
                                    class="badge badge-dark widget-usage__work-download-lido-mets" 
                                    title="#{msg.metadata_dl_lido}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadLidoButtonLabel}"> 
                                    #{msg.downloadLidoButtonLabel}
                                </a>
                            </ui:fragment>
                            
                            <!-- DENKXWEB -->
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'DENKXWEB'}">
                                <a 
                                    href="#{activeDocumentBean.viewManager.denkxwebResolverUrl}"
                                    id="denkxweb"
                                    class="badge badge-dark widget-usage__work-download-lido-mets" 
                                    title="#{msg.metadata_dl_denkxweb}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadDenkxwebButtonLabel}"> 
                                    #{msg.downloadDenkxwebButtonLabel}
                                </a>
                            </ui:fragment>
     
                            <!-- DUBLINCORE -->
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'DUBLINCORE'}">
                                <a 
                                    href="#{activeDocumentBean.viewManager.dublinCoreResolverUrl}"
                                    id="dublincorexml"
                                    class="badge badge-dark widget-usage__work-download-lido-mets" 
                                    title="#{msg.metadata_dl_dublincore}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadDublinCoreButtonLabel}"> 
                                    #{msg.downloadDublinCoreButtonLabel}
                                </a>
                            </ui:fragment>

                            <!-- MARCXML -->
                            <ui:fragment
                                rendered="#{activeDocumentBean.viewManager.oaiMarcUrl != null and (activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'METS' or activeDocumentBean.viewManager.topStructElement.sourceDocFormat == 'METS_MARC')}">
                                <a
                                    id="marc"
                                    href="#{activeDocumentBean.viewManager.oaiMarcUrl}"
                                    class="badge badge-dark widget-usage__work-download-oai-marc"
                                    title="#{msg.metadata_dl_marc}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.marcLink}">
                                    #{msg.marcLink}
                                </a>
                            </ui:fragment>
                        
                            <!-- OAI DC -->
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.oaiDcUrl != null}">
                                <a
                                    id="dc"
                                    href="#{activeDocumentBean.viewManager.oaiDcUrl}"
                                    class="badge badge-dark widget-usage__work-download-oai-dc"
                                    title="#{msg.metadata_dl_dublinCore}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.dcLink}"> 
                                    #{msg.dcLink} 
                                </a>
                            </ui:fragment>
                      
                            <!-- RIS (topstruct) -->
                            <ui:fragment>
                                <a href="#{configurationBean.restApiUrlV1}records/#{activeDocumentBean.persistentIdentifier}/ris/"
                                    id="ris"
                                    class="badge badge-dark widget-usage__work-download-ris" 
                                    title="#{msg.risLinkTopstruct}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    rel="nofollow"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.risLinkTopstruct}"> 
                                    #{msg.risLinkTopstruct} 
                                </a>
                            </ui:fragment>
                        
                        </ui:fragment>
                        
                        <!-- WORK IIIF-RELIANT FUNCTIONS (GENERATE_IIIF_MANIFEST CHECK) -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.topStructElement.accessPermissionGenerateIiifManifest}">   
                        
                            <!-- IIIF MANIFEST -->
                            <ui:fragment rendered="#{!activeDocumentBean.viewManager.bornDigital and activeDocumentBean.viewManager.currentPage.displayImage}">
	                           <button 
                                   id="iiifManifest"
                                   class="badge badge-dark widget-usage__work-download-iiif" 
	                               data-copy-value="#{imageDelivery.iiifManifest}" 
	                               data-copy-done-msg="#{msg.copyUrlDone}"
                                   title="#{msg.copyUrl}"
                                   aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.iiif}"
                                   tabindex="0"> 
	                               #{msg.iiif}
	                           </button>
	                       </ui:fragment>      
	                    
                            <!-- MIRADOR -->
                            <ui:fragment
                                rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.hasPages and !activeDocumentBean.viewManager.filesOnly}">                     
                                    <a
                                        href="#{request.contextPath}/mirador/?pi=#{activeDocumentBean.persistentIdentifier}&amp;page=1" 
                                        id="mirador" 
                                        class="badge badge-dark widget-usage__work-link-mirador-viewer" 
                                        title="#{msg.action__view_in_mirador__tooltip}"
										data-toggle="tooltip"
										data-placement="top"
										data-trigger="hover"
                                        target="_blank" rel="nofollow noopener"
                                        aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.action__view_in_mirador}"> 
                                        #{msg.action__view_in_mirador}
                                    </a> 
                            </ui:fragment>
                        
                        </ui:fragment>
                        
                        <!-- WORK FULLTEXT FORMATS (VIEW_FULLTEXT not checked here because each method already has access permission checks) -->
    
                        <!-- ALTO (WORK) -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForWork}">
                            <a 
                                href="#{activeDocumentBean.viewManager.altoUrlForAllPages}"
                                id="alto" 
                                class="badge badge-dark widget-usage__work-download-alto" 
                                title="#{msg.metadata_dl_alto_work}"
								data-toggle="tooltip"
								data-placement="top"
								data-trigger="hover" rel="nofollow noopener"
                                aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadAltoWorkButtonLabel}"> 
                                #{msg.downloadAltoWorkButtonLabel}
                            </a>
                        </ui:fragment>
                        
                        <!-- TEI (WORK) -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.teiAvailableForWork}">
                            <!-- MULTILANGUAGE -->
                            <ui:fragment rendered="#{activeDocumentBean.viewManager.fulltextFromTEI}"> 
                                <ui:repeat var="lang" value="#{textBean.getRecordLanguages(activeDocumentBean.viewManager.topStructElement)}">
                                    <a href="#{activeDocumentBean.viewManager.getTeiUrlForAllPages(lang)}"
                                        id="teiWork" 
                                        class="badge badge-dark widget-usage__work-download-tei" 
                                        title="#{msg.downloadWorkTei}"
                                        data-toggle="tooltip"
                                        data-placement="top"
                                        data-trigger="hover"
                                        target="_blank" rel="nofollow noopener"
                                        aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.TEI}">
                                        #{msg.TEI} (#{lang})
                                    </a>
                                </ui:repeat>
                            </ui:fragment>
                            <!-- SINGLE LANGUAGE -->
                            <ui:fragment rendered="#{!activeDocumentBean.viewManager.fulltextFromTEI}"> 
                                <a href="#{activeDocumentBean.viewManager.teiUrlForAllPages}"
                                    id="teiWork" 
                                    class="badge badge-dark widget-usage__work-download-tei" 
                                    title="#{msg.downloadWorkTei}"
								    data-toggle="tooltip"
								    data-placement="top"
								    data-trigger="hover"
                                    target="_blank" rel="nofollow noopener"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.TEI}">
                                    #{msg.TEI}
                                </a>
                            </ui:fragment>
                        </ui:fragment>

                        <!-- FULLTEXT (WORK) -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.fulltextAvailableForWork}">
                            <a 
                                href="#{activeDocumentBean.viewManager.fulltextUrlForAllPages}"
                                id="textWork" 
                                class="badge badge-dark widget-usage__work-download-fulltext" 
                                title="#{msg.downloadWorkFulltext}"
								data-toggle="tooltip"
								data-placement="top"
								data-trigger="hover"
                                target="_blank" rel="nofollow noopener"
                                aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.fulltext}">
                                #{msg.fulltext}
                            </a>
                        </ui:fragment>
                        
                        <!-- External download link -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.externalDownloadUrl != null}">
                            <a 
                                href="#{activeDocumentBean.viewManager.externalDownloadUrl}"
                                id="externalDownloadWork" 
                                class="badge badge-dark widget-usage__work-download-external" 
                                title="#{msg.downloadWorkExternal}"
                                data-toggle="tooltip"
                                data-placement="top"
                                data-trigger="hover"
                                target="_blank" rel="nofollow noopener"
                                aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.downloadWorkExternal}">
                                <i class="fa fa-download" aria-hidden="true"></i>
                                #{msg.downloadWorkExternal}
                            </a>
                        </ui:fragment>
        
                        <!-- PDF (WORK) -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.externalDownloadUrl == null and 
                                                 !activeDocumentBean.viewManager.filesOnly and 
                                                 activeDocumentBean.viewManager.hasPages and 
                                                 activeDocumentBean.accessPermissionPdf}">
                            <ui:fragment rendered="#{!configurationBean.generatePdfInTaskManager}">
                            	<c:set scope="request" var="hasPrerenderedPagePdfs" value="#{activeDocumentBean.viewManager.hasPrerenderedPagePdfs()}"/>
                            	<ui:fragment rendered="#{hasPrerenderedPagePdfs}">
                            		<a 
	                                    href="#{activeDocumentBean.viewManager.getPdfDownloadLink([['usePdfSource', 'true']])}" 
	                                    id="pdfWork-small" 
	                                    class="badge badge-dark widget-usage__work-download-pdf" 
	                                    title="#{msg.label__pdf_download_record} (#{msg.label__pdf_download_small})"
										data-toggle="tooltip"
										data-placement="top"
										data-trigger="hover"
	                                    target="_blank" rel="nofollow noopener"
	                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.label__pdf_download}">
                                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                    #{msg.label__pdf_download} (#{msg.label__pdf_download_small})</a>
                                    <a 
	                                    href="#{activeDocumentBean.viewManager.getPdfDownloadLink([['usePdfSource', 'false']])}" 
	                                    id="pdfWork-full" 
	                                    class="badge badge-dark widget-usage__work-download-pdf" 
	                                    title="#{msg.label__pdf_download_record} (#{msg.label__pdf_download_full})"
										data-toggle="tooltip"
										data-placement="top"
										data-trigger="hover"
	                                    target="_blank" rel="nofollow noopener"
	                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.label__pdf_download}">
                                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                    #{msg.label__pdf_download} (#{msg.label__pdf_download_full})</a>
                            	</ui:fragment>
                            	<ui:fragment rendered="#{!hasPrerenderedPagePdfs}">
                            		<a 
	                                    href="#{activeDocumentBean.viewManager.pdfDownloadLink}" 
	                                    id="pdfWork" 
	                                    class="badge badge-dark widget-usage__work-download-pdf" 
	                                    title="#{msg.label__pdf_download_record}"
										data-toggle="tooltip"
										data-placement="top"
										data-trigger="hover"
	                                    target="_blank" rel="nofollow noopener"
	                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.label__pdf_download}">
                                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                    #{msg.label__pdf_download}</a>
                            	</ui:fragment>
                            </ui:fragment>
                            <ui:fragment rendered="#{configurationBean.generatePdfInTaskManager}">
                                <a 
                                    href="#" 
                                    id="pdfWork" 
                                    class="badge badge-dark widget-usage__work-download-pdf download-modal-widget" 
                                    data-type="pdf" 
                                    data-title="#{activeDocumentBean.titleBarLabel}" 
                                    data-id=""
                                    data-pi="#{activeDocumentBean.viewManager.pi}"
                                    title="#{msg.label__pdf_download_record}"
									data-toggle="tooltip"
									data-placement="top"
									data-trigger="hover"
                                    aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.label__pdf_download}">
                                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                    #{msg.label__pdf_download}
                                </a>    
                            </ui:fragment>
                        </ui:fragment>
        
                        <!-- EPUB -->
                        <ui:fragment rendered="#{activeDocumentBean.accessPermissionEpub}">
                            <a 
                                href="#" 
                                class="badge badge-dark widget-usage__work-download-epub download-modal-widget" 
                                data-type="epub" 
                                data-title="#{activeDocumentBean.titleBarLabel}" 
                                data-id=""
                                data-pi="#{activeDocumentBean.viewManager.pi}" 
                                title="#{msg.epubDownload}"
								data-toggle="tooltip"
								data-placement="top"
								data-trigger="hover"
                                aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.epub}">
                                #{msg.epub}
                            </a>
                        </ui:fragment>
        
                        <!-- DFG Viewer -->
                        <ui:fragment rendered="#{!activeDocumentBean.anchor and activeDocumentBean.viewManager.hasPages
                            and activeDocumentBean.viewManager.linkForDFGViewer != null and !activeDocumentBean.viewManager.bornDigital}">
                           <a 
                                href="#{activeDocumentBean.viewManager.linkForDFGViewer}"
                                id="dfgViewer" 
                                class="badge badge-dark widget-usage__work-link-dfg-viewer" 
                                title="#{msg.dfgViewerLink}"
								data-toggle="tooltip"
								data-placement="top"
								data-trigger="hover"
                                target="_blank" rel="nofollow noopener"
                                aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.dfgViewerLink}"> 
                               #{msg.dfgViewerLink}
                            </a>
                        </ui:fragment>
    
                        <!-- OPAC -->
                        <ui:fragment rendered="#{activeDocumentBean.viewManager.opacUrl != null}">
                            <a href="#{activeDocumentBean.viewManager.opacUrl}"
                                id="opac"
                                class="badge badge-dark widget-usage__work-link-opac" 
                                title="#{msg.opacLink}"
								data-toggle="tooltip"
								data-placement="top"
								data-trigger="hover"
                                target="_blank" rel="nofollow noopener"
                                aria-label="#{msg[activeDocumentBean.viewManager.topStructElement.docStructType]}: #{msg.opacLink}">
                                #{msg.opacLink} 
                            </a>
                        </ui:fragment>
                        
                        <!-- TOC -->
						<ui:fragment rendered="#{activeDocumentBean.accessPermissionPdf or activeDocumentBean.accessPermissionEpub or configurationBean.docHierarchyPdfEnabled}">
								<ui:fragment rendered="#{configurationBean.docHierarchyPdfEnabled}">
									<h:form class="d-inline-flex" id="titleBodyForm" prependId="false">
									<h:commandLink
										id="tocDownload"
										action="#{activeDocumentBean.downloadTOCAction()}"
										title="#{msg.tocDownload}"
										styleClass="badge badge-dark widget-usage__work-download-toc"
										value="#{msg.tocDownloadBadge}">
										<f:passThroughAttribute name="data-toggle" value="tooltip" />
										<f:passThroughAttribute name="data-placement" value="top" />
										<f:passThroughAttribute name="aria-label" value="#{msg.tocDownload}" />
									</h:commandLink>
									</h:form>
								</ui:fragment>
						</ui:fragment>
                      
                    </div>
                    
                    
	</composite:implementation>
</ui:composition>