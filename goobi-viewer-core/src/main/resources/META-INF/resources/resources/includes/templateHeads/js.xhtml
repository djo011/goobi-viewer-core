<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <!-- ===============================
        BASE LIBRARIES + CORE MODULES
    ================================ -->
    <!--
        `jsPaths` contains one array for each javascript library,
        each array contains
        - an identifier that allows excluding libraries from viewer theme template files
        - an array of templates to exclude (or empty),
        - a path to the library file:
        [
          name,
          [don't, render, library, here ],
          path/to/lib
        ]
    -->

    <c:set var="jsPaths" value="#{[

      ['jquery',
        [],
        'resources/javascript/libs/jquery/jquery.min.js'
      ],
      ['jqueryUI',
        ['templateMirador'],
        'resources/javascript/libs/jqueryUi/jquery-ui.min.js'
      ],
      ['jqueryUI.touchPunch',
        ['templateAdmin', 'templateCrowdsourcing', 'templateMirador', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/jqueryUi/plugins/jquery.ui.touch-punch.min.js'
      ],
      ['jqueryUI.slider',
        ['templateAdmin', 'templateBlank', 'templateCrowdsourcing', 'templateMirador', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/jqueryUi/plugins/jquery.ui.slider-1.12.1-rtl.js'
      ],
      ['bootstrap',
        [],
        'resources/javascript/libs/bs/bootstrap.bundle.min.js'
      ],
      ['tinymce',
        [ 'template', 'templateMirador', 'templateFullscreen'],
        'resources/javascript/libs/tinymce/tinymce.min.js'
      ],
      ['datatables',
        ['templateAdmin', 'templateCrowdsourcing', 'templateMirador', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/datatables.min.js'
      ],
      ['reactiveX',
        [],
        'resources/javascript/libs/reactiveX/rxjs.umd.min.js'
      ],
      ['pdfJS',
        ['templateAdmin', 'templateCrowdsourcing', 'templateMirador', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/pdfjs/pdf.js'
      ],
      ['intersectionObsPolyfill',
        ['template', 'templateAdmin', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateMirador'],
        'resources/javascript/libs/intersection-observer_polyfill.js'
      ],
      ['riot',
        ['templateMirador'],
        'resources/javascript/libs/riot/riot.min.js'
      ],
      ['swiper',
        ['templateBlank', 'templateCrowdsourcing', 'templateMirador', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/swiper/swiper-bundle.min.js'
      ],
      ['sweetalert',
        [],
        'resources/javascript/libs/sweetalert/sweetalert2.min.js'
      ],
      ['hcSticky',
        ['templateBlank', 'templateCrowdsourcing', 'templateMirador'],
        'resources/javascript/libs/hcsticky/hc-sticky.js'
      ],
      ['leaflet',
        ['templateMirador'],
        'resources/javascript/libs/leaflet/leaflet.js'
      ],
      ['leflet.extra-markers',
        ['templateMirador'],
        'resources/javascript/libs/leaflet/extra-markers/leaflet.extra-markers.min.js'
      ],
      ['leaflet.markercluster',
        ['templateMirador'],
        'resources/javascript/libs/leaflet/markercluster/leaflet.markercluster.js'
      ],
      ['leaflet.draw',
        ['templateAdmin', 'templateBlank', 'templateCrowdsourcing', 'templateMirador', 'templateArchives'],
        'resources/javascript/libs/leaflet/draw/leaflet.draw.js'
      ],
      ['mapbox.gl-geocoder',
        ['templateAdmin', 'templateBlank', 'templateMirador', 'templateArchives'],
        'resources/javascript/libs/mapbox/geocoder/mapbox-gl-geocoder.min.js'
      ],
      ['mapbox.gl',
        ['templateAdmin', 'templateBlank', 'templateMirador', 'templateArchives'],
        'resources/javascript/libs/mapbox/mapbox-gl.js'
      ],
      ['mirador',
        ['template', 'templateAdmin', 'templateBlank', 'templateCrowdsourcing', 'templateArchives', 'templateFullscreen'],
        'resources/javascript/libs/mirador/mirador.min.js'
      ],
      ['openSeadragon',
        ['template', 'templateAdmin', 'templateBlank', 'templateMirador', 'templateFullscreen'],
        'resources/javascript/libs/openseadragon/openseadragon.min.js'
      ],
      ['openSeadragonHook',
        ['template', 'templateAdmin', 'templateBlank', 'templateMirador', 'templateFullscreen'],
        'resources/javascript/libs/openseadragon/openseadragon-viewerinputhook.js'
      ],
      ['chartjs',
        ['templateMirador'],
        'resources/javascript/libs/chartjs/chart.umd.js'
      ],
      ['luxon',
        ['templateMirador'],
        'resources/javascript/libs/chartjs/luxon/luxon.js'
      ],
      ['chartjs-adapter-luxon',
        ['templateMirador'],
        'resources/javascript/libs/chartjs/chartjs-adapter-luxon/chartjs-adapter-luxon.umd.min.js'
      ],
      ['browsersupport',
        [],
        'resources/javascript/dist/browsersupport.min.js'
      ],
      ['codemirror',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/codemirror.js'
      ],
      
      ['codemirrorFullscreen',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/fullscreen.js'
      ],
      ['codemirrorProperties',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/properties.js'
      ],
      ['codemirrorXML',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/xml.js'
      ],
      
      ['codemirrorSearch',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/search.js'
      ],
      
      ['codemirrorSearchCursor',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/searchcursor.js'
      ],
      
      ['codemirrorMatchHighlighter',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/match-highlighter.js'
      ],
      
      ['codemirrorDialog',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/dialog.js'
      ],
      
      ['codemirrorJumpToLine',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/jump-to-line.js'
      ],
      
      ['codemirrorActiveLine',
        ['template', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/codemirror/active-line.js'
      ],
      ['lightbox',
        ['templateAdmin', 'templateArchives', 'templateBlank', 'templateCrowdsourcing', 'templateFullscreen', 'templateMirador'],
        'resources/javascript/libs/simpleLightbox/simpleLightbox.min.js'
      ],
      ['viewerJS',
        [],
        'resources/javascript/dist/viewer.min.js'
      ],
      ['imageView',
        ['template', 'templateAdmin', 'templateBlank', 'templateFullscreen'],
        'resources/javascript/dist/imageView.min.js'
      ],
      ['riotTags',
        ['templateMirador'],
        'resources/javascript/dist/riot-tags.js'
      ]

    ]}" />

    <!-- INCLUDE FILES IF CONDITIONS ARE MET -->
    <c:forEach var="path" items="#{jsPaths}">
      <!-- include file, if it is not explicitly excluded -->
      <!-- (either above, or in the excludeJS variable, which can be set in template files) -->
      <c:if test="#{!path[1].contains(templateName) and !excludeJS.contains(path[0])}">
        <script type="text/javascript" src="#{request.contextPath}/#{path[2]}?${navigationHelper.buildVersion}&amp;#{cacheBuster}"></script>
      </c:if>
    </c:forEach>

    <!-- SHOW AVAILABLE BIBS AND SCRIPTS IN CONSOLE -->
    <!-- an easy way to log library names to the console, just pass `showCSS` to the excludeCSS variable in a template file -->
    <c:if test="#{excludeJS.contains('showJS')}">
      <c:forEach var="path" items="#{jsPaths}">
        <script>
          console.log('%c#{path[0]}', 'background: #3365a9; color: #fff; padding: 2px 6px; border-radius: 2px;')
        </script>
      </c:forEach>
    </c:if>

</ui:composition>

